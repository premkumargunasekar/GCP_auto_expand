---
- name: Run IPAM Python on local server
  hosts: 192.168.116.128
  gather_facts: no

  vars:
    py_script: /etc/ansible/Auto_Expand

  tasks:
    - name: Verify python script exists
      stat:
        path: "{{ py_script }}"
      register: py_stat

    - name: Fail if python script missing
      fail:
        msg: "Python script not found at {{ py_script }}"
      when: not py_stat.stat.exists

    - name: Run Python IPAM logic
      command: >
        python3 {{ py_script }} {{ gcp_project }}
      register: py_out

    - name: Show Python output
      debug:
        var: py_out.stdout


  tasks:
    - name: Verify python script exists
      stat:
        path: "{{ py_script }}"
      register: py_stat

    - name: Fail if python script missing
      fail:
        msg: "Python script not found at {{ py_script }}"
      when: not py_stat.stat.exists

    - name: Run Python IPAM logic
      command: >
        python3 {{ py_script }} {{ gcp_project }}
      register: py_out

    - name: Show Python output
      debug:
        var: py_out.stdout
